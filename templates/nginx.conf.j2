# This file was generated by Ansible for {{ ansible_fqdn }}
# Do NOT modify this file by hand!

server {

    listen     {{graphite_api_nginx_port}};
    server_name {{graphite_api_nginx_host}};

    proxy_set_header   Host                 $http_host;
    proxy_set_header   X-Real-IP            $remote_addr;
    proxy_set_header   X-Forwarded-For      $proxy_add_x_forwarded_for;
    proxy_set_header   X-Forwarded-Proto    $scheme;
    proxy_redirect     off;

    keepalive_timeout 0;

    proxy_read_timeout 5s;
    proxy_send_timeout 5s;
    send_timeout 5s;
    resolver_timeout 5s;
    client_body_timeout 5s;

    client_max_body_size 150k;
    client_body_buffer_size 150k;

    location / {
        proxy_pass        http://{{graphite_api_gunicorn_host}}:{{graphite_api_gunicorn_port}};
{% if graphite_api_nginx_allow_origin %}
        add_header  "Access-Control-Allow-Origin" "*";
        add_header  "Access-Control-Allow-Credentials" "true";
        add_header  "Access-Control-Allow-Methods" "GET, OPTIONS";
        add_header  "Access-Control-Allow-Headers" "Authorization, origin, accept";
{% endif %}
    }

}

